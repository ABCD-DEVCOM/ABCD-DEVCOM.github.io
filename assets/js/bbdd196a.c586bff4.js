"use strict";(self.webpackChunkabcd_devcom_github_io=self.webpackChunkabcd_devcom_github_io||[]).push([[6426],{28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>a});var t=n(96540);const i={},o=t.createContext(i);function c(e){const s=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(o.Provider,{value:s},e.children)}},73538:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"abcd-modules/opac-abcd/opac-admin/advanced-access","title":"Access Control & Contexts","description":"The Multi-Context System allows a single ABCD OPAC installation to serve multiple libraries, institutions, or database collections independently. By using a simple URL parameter (?ctx=...), the system switches the physical directory where it looks for databases (bases), effectively creating separate environments.","source":"@site/docs/abcd-modules/opac-abcd/opac-admin/advanced-access.md","sourceDirName":"abcd-modules/opac-abcd/opac-admin","slug":"/abcd-modules/opac-abcd/opac-admin/advanced-access","permalink":"/docs/3.1/abcd-modules/opac-abcd/opac-admin/advanced-access","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/abcd-modules/opac-abcd/opac-admin/advanced-access.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Access Control & Contexts","sidebar_label":"Access Control","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Display & Tools","permalink":"/docs/3.1/abcd-modules/opac-abcd/opac-admin/display-tools"},"next":{"title":"A-Z Browsing","permalink":"/docs/3.1/abcd-modules/opac-abcd/opac-admin/browsing-config"}}');var i=n(74848),o=n(28453);const c={title:"Access Control & Contexts",sidebar_label:"Access Control",sidebar_position:6},a="Multi-Context System Documentation",r={},l=[{value:"1. How it Works",id:"1-how-it-works",level:3},{value:"2. How to Enable It",id:"2-how-to-enable-it",level:3},{value:"Block 1: Initialization",id:"block-1-initialization",level:3},{value:"Block 2: User Configuration (Edit Here)",id:"block-2-user-configuration-edit-here",level:3},{value:"Block 3: Context Resolution Logic",id:"block-3-context-resolution-logic",level:3},{value:"Block 4: Mode Logic (Integrated vs. Single Base)",id:"block-4-mode-logic-integrated-vs-single-base",level:3},{value:"Block 5: Language Detection",id:"block-5-language-detection",level:3},{value:"Block 6: Visual and Functional Settings",id:"block-6-visual-and-functional-settings",level:3}];function d(e){const s={code:"code",h1:"h1",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"multi-context-system-documentation",children:"Multi-Context System Documentation"})}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.strong,{children:"Multi-Context System"})," allows a single ABCD OPAC installation to serve multiple libraries, institutions, or database collections independently. By using a simple URL parameter (",(0,i.jsx)(s.code,{children:"?ctx=..."}),"), the system switches the physical directory where it looks for databases (",(0,i.jsx)(s.code,{children:"bases"}),"), effectively creating separate environments."]}),"\n",(0,i.jsx)(s.h3,{id:"1-how-it-works",children:"1. How it Works"}),"\n",(0,i.jsxs)(s.p,{children:["Instead of having a hardcoded path to the databases (e.g., ",(0,i.jsx)(s.code,{children:"/var/www/bases/"}),"), the system uses a ",(0,i.jsx)(s.strong,{children:"Mapping Logic"}),":"]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"The User Request:"})," The user accesses a URL like ",(0,i.jsx)(s.code,{children:"http://myserver/opac/?ctx=law"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"The Lookup:"})," The system checks the ",(0,i.jsx)(s.code,{children:"config_opac.php"}),' file for a "map" that links the alias ',(0,i.jsx)(s.code,{children:"law"})," to a specific physical folder on the server (e.g., ",(0,i.jsx)(s.code,{children:"C:/abcd/bases-law/"}),")."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"The Switch:"})," If the context is valid, the system sets the internal ",(0,i.jsx)(s.code,{children:"$db_path"})," variable to that specific folder. All subsequent operations (searching, displaying records, loading configuration files) will happen inside that folder."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session Persistence:"})," The system remembers the current context in the user's session. This ensures that if the user clicks a link that accidentally omits the ",(0,i.jsx)(s.code,{children:"?ctx="})," parameter, they remain in the correct library."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"2-how-to-enable-it",children:"2. How to Enable It"}),"\n",(0,i.jsxs)(s.p,{children:["To enable this feature, you must edit the ",(0,i.jsx)(s.code,{children:"config_opac.php"})," file located in the ",(0,i.jsx)(s.code,{children:"opac/"})," directory (or the central configuration directory, depending on your setup)."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 1: Activate the Feature"}),"\r\nLocate the ",(0,i.jsx)(s.code,{children:"$opac_multi_context"})," variable and set it to ",(0,i.jsx)(s.code,{children:"true"}),"."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-php",children:"$opac_multi_context = true;\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 2: Configure Strict Mode (Optional but Recommended)"}),"\r\nStrict mode prevents users from accessing the OPAC without specifying a context (which would otherwise load the default/root databases)."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-php",children:"$opac_strict_mode = true; // Blocks access if ?ctx= is missing\n"})}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Step 3: Define the Context Map"}),"\r\nThis is the most important step. You define an array where the ",(0,i.jsx)(s.strong,{children:"key"})," is the URL alias and the ",(0,i.jsx)(s.strong,{children:"value"})," is the full physical path to the ",(0,i.jsx)(s.code,{children:"bases"})," folder for that client."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-php",children:"$opac_context_map = array(\r\n    // 'URL_ALIAS'  =>  'PHYSICAL_PATH_ON_SERVER'\r\n    'demo'          =>  'C:/xampp/htdocs/ABCD2/www/bases-examples_Windows/',\r\n    'medicine'      =>  'C:/xampp/htdocs/ABCD2/www/bases-medicina/',\r\n    'law_library'   =>  '/var/www/abcd/bases-law/',\r\n);\n"})}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.h1,{id:"\ufe0f-important-points-of-config_opacphp",children:["\u2699\ufe0f Important Points of ",(0,i.jsx)(s.code,{children:"config_opac.php"})]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.code,{children:"config_opac.php"})," file is the brain of the OPAC. It is structured into logical blocks to separate user configuration from system logic."]}),"\n",(0,i.jsx)(s.h3,{id:"block-1-initialization",children:"Block 1: Initialization"}),"\n",(0,i.jsx)(s.p,{children:"This section handles PHP settings and loads the core ABCD configurations."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session Start:"})," It ensures a PHP session is active to store the user's current context and language."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Central Config:"})," It includes ",(0,i.jsx)(s.code,{children:"central/config.php"})," to get system-wide defaults."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"block-2-user-configuration-edit-here",children:"Block 2: User Configuration (Edit Here)"}),"\n",(0,i.jsx)(s.p,{children:"This is where administrators make changes."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Multi-Context Switches:"})," As explained above (",(0,i.jsx)(s.code,{children:"$opac_multi_context"}),", ",(0,i.jsx)(s.code,{children:"$opac_strict_mode"}),")."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Context Map:"})," The list of available libraries (",(0,i.jsx)(s.code,{children:"$opac_context_map"}),")."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"block-3-context-resolution-logic",children:"Block 3: Context Resolution Logic"}),"\n",(0,i.jsxs)(s.p,{children:["This section contains the logic that determines which database path (",(0,i.jsx)(s.code,{children:"$db_path"}),") to use. ",(0,i.jsx)(s.strong,{children:"You generally do not need to edit this."})]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"URL Detection:"})," Checks if ",(0,i.jsx)(s.code,{children:"$_REQUEST['ctx']"})," exists and matches an entry in the map."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session Fallback:"})," If the URL has no context, it checks ",(0,i.jsx)(s.code,{children:"$_SESSION"})," to see if the user was already browsing a specific library."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Security Check:"})," If ",(0,i.jsx)(s.code,{children:"Strict Mode"}),' is on and no context is found, it kills the process with an "Access Denied" message (unless running in the Administrative module).']}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Sanitization:"})," Ensures paths end with a correct directory separator (",(0,i.jsx)(s.code,{children:"/"}),")."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"block-4-mode-logic-integrated-vs-single-base",children:"Block 4: Mode Logic (Integrated vs. Single Base)"}),"\n",(0,i.jsx)(s.p,{children:"Controls the search behavior:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Integrated Mode:"})," Searches across all databases defined in ",(0,i.jsx)(s.code,{children:"bases.dat"}),". Active by default on the home page."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Single Base Mode:"})," If the URL contains ",(0,i.jsx)(s.code,{children:"&base=marc"}),", this logic automatically disables Integrated Mode so the search is restricted to that specific database."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"block-5-language-detection",children:"Block 5: Language Detection"}),"\n",(0,i.jsx)(s.p,{children:"A robust logic to determine the interface language, prioritized as follows:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session (Admin):"})," If an administrator is logged in, their language preference wins."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"URL Request:"})," If the user clicks a flag (",(0,i.jsx)(s.code,{children:"?lang=pt"}),"), that choice takes precedence and is saved."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Session (Visitor):"})," Remembers the visitor's choice during navigation."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Browser:"})," Tries to detect the browser's default language."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Default:"})," Falls back to the system default."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"block-6-visual-and-functional-settings",children:"Block 6: Visual and Functional Settings"}),"\n",(0,i.jsx)(s.p,{children:"Loads specific visual settings for the active base."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsxs)(s.strong,{children:[(0,i.jsx)(s.code,{children:"opac.def"}),":"]})," Reads the specific configuration file for the current language/base (colors, texts)."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsxs)(s.strong,{children:[(0,i.jsx)(s.code,{children:"$restricted_opac"}),":"]})," Defines if the OPAC requires login (",(0,i.jsx)(s.code,{children:"Y"})," or ",(0,i.jsx)(s.code,{children:"N"}),")."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Global Styles:"})," Checks for ",(0,i.jsx)(s.code,{children:"global_style.def"})," to apply custom CSS overrides per context."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);