"use strict";(self.webpackChunkabcd_devcom_github_io=self.webpackChunkabcd_devcom_github_io||[]).push([[8092],{14329:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"abcd-modules/opac-abcd/opac-admin/opac-security","title":"Security & Logging","description":"This documentation details the implementations carried out to shield the OPAC against unwanted access, clean up search records, and protect system integrity.","source":"@site/docs/abcd-modules/opac-abcd/opac-admin/opac-security.md","sourceDirName":"abcd-modules/opac-abcd/opac-admin","slug":"/abcd-modules/opac-abcd/opac-admin/opac-security","permalink":"/docs/3.1/abcd-modules/opac-abcd/opac-admin/opac-security","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/abcd-modules/opac-abcd/opac-admin/opac-security.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Security & Logging","sidebar_label":"Security & Logs","sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"A-Z Browsing","permalink":"/docs/3.1/abcd-modules/opac-abcd/opac-admin/browsing-config"},"next":{"title":"Overview","permalink":"/docs/3.1/abcd-modules/opac-abcd/opac-user/"}}');var i=n(74848),r=n(28453);const c={title:"Security & Logging",sidebar_label:"Security & Logs",sidebar_position:7},d="\ud83d\udee1\ufe0f Security and Logging Documentation",o={},a=[{value:"1. Log Optimization (<code>log_buscas.php</code>)",id:"1-log-optimization-log_buscasphp",level:2},{value:"Implemented Features:",id:"implemented-features",level:3},{value:"2. Input Validation and Shielding (<code>is_malicious.php</code>)",id:"2-input-validation-and-shielding-is_maliciousphp",level:2},{value:"Defense Mechanisms:",id:"defense-mechanisms",level:3},{value:"3. Infrastructure and Context (<code>config_opac.php</code>)",id:"3-infrastructure-and-context-config_opacphp",level:2},{value:"Improvements:",id:"improvements",level:3},{value:"4. Error and Type Handling (<code>forms.php</code>, <code>leer_bases.php</code>, etc.)",id:"4-error-and-type-handling-formsphp-leer_basesphp-etc",level:2},{value:"Adjustments Made:",id:"adjustments-made",level:3},{value:"Protection Summary",id:"protection-summary",level:3}];function l(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"\ufe0f-security-and-logging-documentation",children:"\ud83d\udee1\ufe0f Security and Logging Documentation"})}),"\n",(0,i.jsx)(t.p,{children:"This documentation details the implementations carried out to shield the OPAC against unwanted access, clean up search records, and protect system integrity."}),"\n",(0,i.jsxs)(t.h2,{id:"1-log-optimization-log_buscasphp",children:["1. Log Optimization (",(0,i.jsx)(t.code,{children:"log_buscas.php"}),")"]}),"\n",(0,i.jsx)(t.p,{children:'The goal was to eliminate "noise" caused by robots and automated attacks, ensuring that statistical reports reflect only the behavior of real users.'}),"\n",(0,i.jsx)(t.h3,{id:"implemented-features",children:"Implemented Features:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Bot Detection (Bot Filter):"})," The system now analyzes the visitor's ",(0,i.jsx)(t.code,{children:"User-Agent"}),". If it contains signatures of known bots (Googlebot, Bingbot, Yahoo, Python, Curl, etc.), the search is ",(0,i.jsx)(t.strong,{children:"not recorded"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"System Artifact Filter:"})," Searches initiated by clicking on facets or indexes (which generate terms like ",(0,i.jsx)(t.code,{children:"FUL_Mackenzie"}),", ",(0,i.jsx)(t.code,{children:"NOM_Silva"}),", ",(0,i.jsx)(t.code,{children:"TIL_Ciencias"}),") are detected via RegEx (",(0,i.jsx)(t.code,{children:"^[A-Z]{2,4}_"}),') and ignored in the "typed terms" log.']}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Attack Blocking in Logs:"})," Attempts at ",(0,i.jsx)(t.em,{children:"Directory Traversal"})," (e.g., ",(0,i.jsx)(t.code,{children:"../../etc/passwd"}),") or injections are silently discarded to avoid polluting the history."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Length Validation:"})," Very short terms (< 2 characters) or excessively long terms (> 255 characters) are ignored."]}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsxs)(t.h2,{id:"2-input-validation-and-shielding-is_maliciousphp",children:["2. Input Validation and Shielding (",(0,i.jsx)(t.code,{children:"is_malicious.php"}),")"]}),"\n",(0,i.jsxs)(t.p,{children:["We implemented a security strategy based on a ",(0,i.jsx)(t.strong,{children:"Whitelist"}),', reversing the logic of "trying to guess the attack" to "only accepting what is known".']}),"\n",(0,i.jsx)(t.h3,{id:"defense-mechanisms",children:"Defense Mechanisms:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Parameter Whitelist:"})," The system strictly defines which URL keys are accepted (e.g., ",(0,i.jsx)(t.code,{children:"base"}),", ",(0,i.jsx)(t.code,{children:"cipar"}),", ",(0,i.jsx)(t.code,{children:"Expresion"}),"). Any unknown parameter (e.g., ",(0,i.jsx)(t.code,{children:"cmd"}),", ",(0,i.jsx)(t.code,{children:"admin"}),", ",(0,i.jsx)(t.code,{children:"union"}),") triggers an immediate block of the request."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Content Inspection:"})," Received values are scanned against attack patterns:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"SQL Injection:"})," Blocks patterns like ",(0,i.jsx)(t.code,{children:"UNION SELECT"}),", ",(0,i.jsx)(t.code,{children:"OR 1=1"}),", ",(0,i.jsx)(t.code,{children:"information_schema"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"XSS (Cross-Site Scripting):"})," Blocks tags ",(0,i.jsx)(t.code,{children:"<script>"}),", ",(0,i.jsx)(t.code,{children:"javascript:"}),", etc."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Path Traversal:"})," Blocks directory navigation sequences (",(0,i.jsx)(t.code,{children:"../"}),", ",(0,i.jsx)(t.code,{children:"..%2F"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Array Support:"})," Validation is recursive, protecting even complex form fields (e.g., ",(0,i.jsx)(t.code,{children:"camp[]"}),", ",(0,i.jsx)(t.code,{children:"Sub_Expresiones[]"}),") used in detailed search."]}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsxs)(t.h2,{id:"3-infrastructure-and-context-config_opacphp",children:["3. Infrastructure and Context (",(0,i.jsx)(t.code,{children:"config_opac.php"}),")"]}),"\n",(0,i.jsx)(t.p,{children:"Structural security was reinforced through the Multi-Context system."}),"\n",(0,i.jsx)(t.h3,{id:"improvements",children:"Improvements:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Strict Mode:"})," If enabled, the system blocks any direct access to the OPAC root that does not specify a library context (",(0,i.jsx)(t.code,{children:"?ctx=..."}),'). This prevents unauthorized navigation or access to "default" databases that should not be public.']}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Path Sanitization:"})," The physical path of the databases (",(0,i.jsx)(t.code,{children:"$db_path"}),") is resolved internally by the server through the context map, preventing the user from manipulating the path via URL."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Session Protection:"}),' The context is persisted in the session, ensuring that the user does not accidentally "drop" into another library during navigation.']}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsxs)(t.h2,{id:"4-error-and-type-handling-formsphp-leer_basesphp-etc",children:["4. Error and Type Handling (",(0,i.jsx)(t.code,{children:"forms.php"}),", ",(0,i.jsx)(t.code,{children:"leer_bases.php"}),", etc.)"]}),"\n",(0,i.jsx)(t.p,{children:"Correction of logical vulnerabilities and fatal errors in scripts that handle user data."}),"\n",(0,i.jsx)(t.h3,{id:"adjustments-made",children:"Adjustments Made:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Array Manipulation:"})," Legacy ABCD scripts expected all inputs to be Strings. Critical files (",(0,i.jsx)(t.code,{children:"leer_bases.php"}),", ",(0,i.jsx)(t.code,{children:"sort_dropdown.php"}),", ",(0,i.jsx)(t.code,{children:"search_detailed.php"}),", ",(0,i.jsx)(t.code,{children:"forms.php"}),") were updated to correctly iterate over Arrays (",(0,i.jsx)(t.code,{children:"is_array"}),"), avoiding PHP 8+ fatal errors (",(0,i.jsx)(t.code,{children:"TypeError"}),")."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Output Escaping:"})," Rigorous application of ",(0,i.jsx)(t.code,{children:"htmlspecialchars()"})," at all points where received data (",(0,i.jsx)(t.code,{children:"$_REQUEST"}),") is printed to the screen (hidden forms, links), preventing HTML/JS injection."]}),"\n"]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"protection-summary",children:"Protection Summary"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Layer"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Action"}),(0,i.jsx)(t.th,{style:{textAlign:"left"},children:"Result"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Input (Request)"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Whitelist + Regex"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Blocks attacks before processing."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Processing"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Strict Mode + Sanitization"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Ensures access only to allowed folders."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Output (Log)"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Bot Filter"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Generates clean and real statistics."})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{style:{textAlign:"left"},children:(0,i.jsx)(t.strong,{children:"Interface"})}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Output Escaping"}),(0,i.jsx)(t.td,{style:{textAlign:"left"},children:"Prevents layout breakage and XSS."})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>d});var s=n(96540);const i={},r=s.createContext(i);function c(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);